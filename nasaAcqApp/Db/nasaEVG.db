#
# Global acquisition control.
# Fanned out by the event generator.
# Hardwire the first node to be the event generator.
#
record(bo, "$(P)ACQ:enable") {
    field(DESC, "Enable/disable data acquisition")
    field(DTYP, "FEED Register Write")
    field(OUT,  "@name=$(PORT) reg=ACQ:enable")
    field(ZNAM, "Disable")
    field(ONAM, "Enable")
}

record(mbbo, "$(P)ACQ:rate") {
    field(DESC, "Set acquisition rate")
    field(PINI, "YES")
    field(ZRVL, "250000")
    field(ZRST, "250 kHz")
    field(ONVL, "50000")
    field(ONST, "50 kHz")
    field(TWVL, "25000")
    field(TWST, "25 kHz")
    field(THVL, "5000")
    field(THST, "5 kHz")
    field(FRVL, "1000")
    field(FRST, "1 kHz")
    field(VAL,  "0")
    field(FLNK, "$(P)ACQ:rateLO_")
}
# We want the per-FPGA records to process each time the mbbo above processes.
# The MBBO record, unfortunately, does not have an MDEL field, so we have to
# fake it here with this longout.  The per-FPGA records monitor this longout.
record(longout, "$(P)ACQ:rateLO_") {
    field(DESC, "Send monitors to per-FPGA records")
    field(DOL,  "$(P)ACQ:rate.RVAL")
    field(OMSL, "closed_loop")
    field(MDEL, "-1")
}
